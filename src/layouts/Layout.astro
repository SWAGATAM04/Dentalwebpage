---
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import BookingPopup from '../components/BookingPopup.astro';
import { clinicInfo } from '../utils/clinicInfo';
import '@fontsource/montserrat/400.css';
import '@fontsource/montserrat/500.css';
import '@fontsource/montserrat/600.css';
import '@fontsource/montserrat/700.css';
import '@fontsource/open-sans/400.css';
import '@fontsource/open-sans/500.css';
import '@fontsource/open-sans/600.css';
import 'aos/dist/aos.css';
import 'swiper/css';
import 'swiper/css/pagination';
import 'swiper/css/navigation';

export interface Props {
  title: string;
  description?: string;
  image?: string;
  canonical?: string;
  type?: 'website' | 'article';
  publishDate?: string;
  modifiedDate?: string;
}

const {
  title,
  description = "Lilac Dental provides exceptional dental care with a gentle touch in Austin, TX. Our experienced team offers comprehensive dental services including cleanings, implants, and cosmetic dentistry.",
  image = "/images/og/lilac-dental-og.jpg",
  canonical = Astro.url.pathname,
  type = 'website',
  publishDate,
  modifiedDate
} = Astro.props;

const siteUrl = "https://lilacdentalaustintx.com";
const fullCanonical = `${siteUrl}${canonical}`;
const ogImage = `${siteUrl}${image}`;

// Construct SEO-optimized title
const pageTitle = title === 'Welcome to Lilac Dental' 
  ? `Lilac Dental | Top-Rated Dentist in Austin, TX | Family & Cosmetic Dentistry`
  : `${title} | Lilac Dental Austin, TX | Expert Dental Care`;

// Schema.org structured data
const dentistSchema = {
  "@context": "https://schema.org",
  "@type": "Dentist",
  "@id": siteUrl,
  "name": clinicInfo.name,
  "image": `${siteUrl}/images/logo.png`,
  "url": siteUrl,
  "telephone": clinicInfo.phone,
  "priceRange": "$$",
  "address": {
    "@type": "PostalAddress",
    "streetAddress": clinicInfo.address.line1,
    "addressLocality": clinicInfo.address.city,
    "addressRegion": clinicInfo.address.state,
    "postalCode": clinicInfo.address.zip,
    "addressCountry": "US"
  },
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": clinicInfo.coordinates.latitude,
    "longitude": clinicInfo.coordinates.longitude
  },
  "openingHoursSpecification": [
    {
      "@type": "OpeningHoursSpecification",
      "dayOfWeek": ["Monday", "Wednesday", "Thursday"],
      "opens": "09:00",
      "closes": "17:00"
    },
    {
      "@type": "OpeningHoursSpecification",
      "dayOfWeek": "Friday",
      "opens": "10:00",
      "closes": "14:00"
    },
    {
      "@type": "OpeningHoursSpecification",
      "dayOfWeek": "Saturday",
      "opens": "09:00",
      "closes": "14:00"
    }
  ],
  "sameAs": [
    clinicInfo.social.facebook,
    clinicInfo.social.twitter,
    clinicInfo.social.yelp
  ],
  "areaServed": {
    "@type": "City",
    "name": "Austin",
    "sameAs": "https://en.wikipedia.org/wiki/Austin,_Texas"
  },
  "hasOfferCatalog": {
    "@type": "OfferCatalog",
    "name": "Dental Services",
    "itemListElement": [
      {
        "@type": "Offer",
        "itemOffered": {
          "@type": "Service",
          "name": "Dental Checkup",
          "url": `${siteUrl}/services/dental-checkup`
        }
      },
      {
        "@type": "Offer",
        "itemOffered": {
          "@type": "Service",
          "name": "Teeth Cleaning",
          "url": `${siteUrl}/services/teeth-cleaning`
        }
      },
      {
        "@type": "Offer",
        "itemOffered": {
          "@type": "Service",
          "name": "Dental Implants",
          "url": `${siteUrl}/services/dental-implants`
        }
      }
    ]
  },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.9",
    "reviewCount": "150"
  },
  "review": {
    "@type": "Review",
    "reviewRating": {
      "@type": "Rating",
      "ratingValue": "5"
    },
    "author": {
      "@type": "Person",
      "name": "Jennifer Davis"
    },
    "reviewBody": "I've been a patient at Lilac Dental for over 5 years now. Dr. Suman and his team always make me feel comfortable and provide exceptional care."
  }
};

// Add breadcrumb schema if not homepage
const isBreadcrumbPage = canonical !== '/';
const breadcrumbSchema = isBreadcrumbPage ? {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": siteUrl
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": title,
      "item": fullCanonical
    }
  ]
} : null;

// Local business schema
const localBusinessSchema = {
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  "@id": `${siteUrl}#localbusiness`,
  "name": clinicInfo.name,
  "image": `${siteUrl}/images/logo.png`,
  "url": siteUrl,
  "telephone": clinicInfo.phone,
  "address": {
    "@type": "PostalAddress",
    "streetAddress": clinicInfo.address.line1,
    "addressLocality": clinicInfo.address.city,
    "addressRegion": clinicInfo.address.state,
    "postalCode": clinicInfo.address.zip,
    "addressCountry": "US"
  },
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": clinicInfo.coordinates.latitude,
    "longitude": clinicInfo.coordinates.longitude
  },
  "openingHoursSpecification": dentistSchema.openingHoursSpecification,
  "priceRange": "$$"
};
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    
    <!-- Primary Meta Tags -->
    <title>{pageTitle}</title>
    <meta name="title" content={pageTitle} />
    <meta name="description" content={description} />
    <meta name="author" content={clinicInfo.name} />
    <meta name="keywords" content="dentist, dental care, Austin dentist, teeth cleaning, dental implants, cosmetic dentistry, family dentist, emergency dental care, Austin TX" />
    
    <!-- Language and Location -->
    <meta name="language" content="English" />
    <meta name="geo.region" content="US-TX" />
    <meta name="geo.placename" content={clinicInfo.address.city} />
    <meta name="geo.position" content={`${clinicInfo.coordinates.latitude};${clinicInfo.coordinates.longitude}`} />
    <meta name="ICBM" content={`${clinicInfo.coordinates.latitude}, ${clinicInfo.coordinates.longitude}`} />
    
    <!-- Mobile Specific -->
    <meta name="format-detection" content="telephone=yes" />
    <meta name="theme-color" content="#6B46C1" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    
    <!-- Canonical URL -->
    <link rel="canonical" href={fullCanonical} />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={type} />
    <meta property="og:url" content={fullCanonical} />
    <meta property="og:title" content={pageTitle} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImage} />
    <meta property="og:site_name" content={clinicInfo.name} />
    <meta property="og:locale" content="en_US" />
    {publishDate && <meta property="article:published_time" content={publishDate} />}
    {modifiedDate && <meta property="article:modified_time" content={modifiedDate} />}
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={fullCanonical} />
    <meta property="twitter:title" content={pageTitle} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={ogImage} />
    <meta name="twitter:creator" content="@lilacdentaltx" />
    
    <!-- Schema.org Structured Data -->
    <script type="application/ld+json" set:html={JSON.stringify(dentistSchema)} />
    {isBreadcrumbPage && <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />}
    <script type="application/ld+json" set:html={JSON.stringify(localBusinessSchema)} />
    
    <!-- Preconnect to domains -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://www.google.com" crossorigin />
    <link rel="preconnect" href="https://www.gstatic.com" crossorigin />
    
    <!-- reCAPTCHA v3 -->
    <script>
      window.recaptchaCallback = function() {
        // reCAPTCHA is ready
      };
    </script>
    <script 
      src={`https://www.google.com/recaptcha/api.js?render=${import.meta.env.PUBLIC_RECAPTCHA_SITE_KEY}&onload=recaptchaCallback`}
      async 
      defer
    ></script>
    
    <!-- Initialize Swiper -->
    <script>
      import Swiper from 'swiper';
      import { Autoplay, Pagination, Navigation } from 'swiper/modules';
      
      // Register Swiper modules
      Swiper.use([Autoplay, Pagination, Navigation]);
      window.Swiper = Swiper;
    </script>
    
    <script is:inline>
      // Check for dark mode preference
      const theme = localStorage.getItem('theme') || 
        (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      document.documentElement.classList.toggle('dark', theme === 'dark');
    </script>
    
    <slot name="head" />
  </head>
  <body class="antialiased bg-gray-50 text-gray-800 min-h-screen flex flex-col">
    <Header />
    <main class="flex-grow">
      <slot />
    </main>
    <Footer />
    <BookingPopup />

    <script>
      import AOS from 'aos';
      
      // Initialize AOS animation library
      document.addEventListener('DOMContentLoaded', () => {
        AOS.init({
          duration: 800,
          easing: 'ease-in-out',
          once: true,
          mirror: false
        });
      });
    </script>
  </body>
</html>
